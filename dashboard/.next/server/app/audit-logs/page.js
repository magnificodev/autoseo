(()=>{var e={};e.id=331,e.ids=[331],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5575:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>d}),a(9465),a(3119),a(5866);var r=a(3191),s=a(8716),n=a(7922),i=a.n(n),l=a(5231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);a.d(t,o);let d=["",{children:["audit-logs",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,9465)),"D:\\Workspace\\beesmart\\autoseo\\dashboard\\app\\audit-logs\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,3119)),"D:\\Workspace\\beesmart\\autoseo\\dashboard\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,5866,23)),"next/dist/client/components/not-found-error"]}],c=["D:\\Workspace\\beesmart\\autoseo\\dashboard\\app\\audit-logs\\page.tsx"],u="/audit-logs/page",m={require:a,loadChunk:()=>Promise.resolve()},p=new r.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/audit-logs/page",pathname:"/audit-logs",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},7526:(e,t,a)=>{Promise.resolve().then(a.bind(a,7175))},894:(e,t,a)=>{Promise.resolve().then(a.bind(a,4196)),Promise.resolve().then(a.bind(a,9082)),Promise.resolve().then(a.bind(a,8143))},886:(e,t,a)=>{Promise.resolve().then(a.t.bind(a,2994,23)),Promise.resolve().then(a.t.bind(a,6114,23)),Promise.resolve().then(a.t.bind(a,9727,23)),Promise.resolve().then(a.t.bind(a,9671,23)),Promise.resolve().then(a.t.bind(a,1868,23)),Promise.resolve().then(a.t.bind(a,4759,23))},7175:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>u});var r=a(326),s=a(7577),n=a(567),i=a(772),l=a(4432),o=a(5304),d=a(5940);let c={approve:{variant:"default",label:"Duyệt"},reject:{variant:"destructive",label:"Từ chối"},publish:{variant:"outline",label:"Xuất bản"},create:{variant:"secondary",label:"Tạo mới"},update:{variant:"secondary",label:"Cập nhật"},delete:{variant:"destructive",label:"X\xf3a"}};function u(){let[e,t]=(0,s.useState)([]),[a,u]=(0,s.useState)(null),[m,p]=(0,s.useState)(""),[h,x]=(0,s.useState)(""),[b,g]=(0,s.useState)(""),[f,v]=(0,s.useState)(!1),[y,j]=(0,s.useState)(!1);async function w(e){if((e.headers.get("content-type")||"").includes("application/json"))return e.json();throw Error((await e.text()).slice(0,300))}async function N(){try{j(!0),u(null);let e=new URLSearchParams;e.set("limit","200"),m.trim()&&e.set("action",m.trim()),h.trim()&&e.set("start",h.trim()),b.trim()&&e.set("end",b.trim());let a=await fetch(`/api/audit-logs/?${e.toString()}`,{credentials:"include"});if(!a.ok)throw Error(await a.text());let r=await w(a);t(r)}catch(e){u(e.message||"Error")}finally{j(!1)}}return(0,r.jsxs)("div",{className:"space-y-4",children:[r.jsx("h1",{className:"text-2xl font-bold",children:"Audit Logs"}),(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),N()},className:"flex items-center gap-2 flex-wrap",children:[(0,r.jsxs)("select",{value:m,onChange:e=>p(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md text-sm",children:[r.jsx("option",{value:"",children:"Tất cả h\xe0nh động"}),r.jsx("option",{value:"approve",children:"Duyệt"}),r.jsx("option",{value:"reject",children:"Từ chối"}),r.jsx("option",{value:"publish",children:"Xuất bản"}),r.jsx("option",{value:"create",children:"Tạo mới"}),r.jsx("option",{value:"update",children:"Cập nhật"}),r.jsx("option",{value:"delete",children:"X\xf3a"})]}),r.jsx(l.I,{type:"datetime-local",value:h,onChange:e=>x(e.target.value),placeholder:"Từ ng\xe0y"}),r.jsx(l.I,{type:"datetime-local",value:b,onChange:e=>g(e.target.value),placeholder:"Đến ng\xe0y"}),r.jsx(i.z,{type:"submit",disabled:y,children:y?"Đang tải...":"Lọc"}),r.jsx(i.z,{type:"button",variant:"secondary",disabled:f,onClick:async()=>{try{v(!0);let e=new URLSearchParams;e.set("limit","500"),m.trim()&&e.set("action",m.trim()),h.trim()&&e.set("start",h.trim()),b.trim()&&e.set("end",b.trim());let t=await fetch(`/api/audit-logs/?${e.toString()}`,{credentials:"include"});if(!t.ok)throw Error(await t.text());let a=await w(t),r=e=>{let t=null==e?"":String(e);return t.includes('"')||t.includes(",")||t.includes("\n")?'"'+t.replace(/"/g,'""')+'"':t},s=a.map(e=>[e.id,e.actor_user_id,e.action,e.target_type,e.target_id,e.note??"",e.created_at??""]),n=["id,actor_user_id,action,target_type,target_id,note,created_at",...s.map(e=>e.map(r).join(","))].join("\n"),i=new Blob([n],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(i),o=document.createElement("a");o.href=l,o.download=`audit_logs_${Date.now()}.csv`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(l)}catch(e){u(e.message||"Export error")}finally{v(!1)}},children:f?"Đang xuất...":"Xuất CSV"})]}),a&&r.jsx("div",{className:"text-red-600 text-sm",children:a}),r.jsx("div",{className:"overflow-x-auto",children:(0,r.jsxs)(d.iA,{children:[r.jsx(d.xD,{children:(0,r.jsxs)(d.SC,{children:[r.jsx(d.ss,{children:"ID"}),r.jsx(d.ss,{children:"Người thực hiện"}),r.jsx(d.ss,{children:"H\xe0nh động"}),r.jsx(d.ss,{children:"Đối tượng"}),r.jsx(d.ss,{children:"Ghi ch\xfa"}),r.jsx(d.ss,{children:"Thời gian"})]})}),(0,r.jsxs)(d.RM,{children:[y&&r.jsx(d.SC,{children:r.jsx(d.pj,{colSpan:6,children:(0,r.jsxs)("div",{className:"space-y-2",children:[r.jsx(o.O,{className:"h-4 w-full"}),r.jsx(o.O,{className:"h-4 w-3/4"}),r.jsx(o.O,{className:"h-4 w-1/2"})]})})}),0===e.length&&!y&&r.jsx(d.SC,{children:r.jsx(d.pj,{colSpan:6,className:"text-center text-gray-500",children:"Kh\xf4ng c\xf3 log n\xe0o."})}),e.map(e=>(0,r.jsxs)(d.SC,{children:[(0,r.jsxs)(d.pj,{className:"font-medium",children:["#",e.id]}),(0,r.jsxs)(d.pj,{children:["User #",e.actor_user_id]}),r.jsx(d.pj,{children:r.jsx(n.C,{variant:c[e.action]?.variant||"secondary",children:c[e.action]?.label||e.action})}),(0,r.jsxs)(d.pj,{children:[e.target_type,"#",e.target_id]}),r.jsx(d.pj,{className:"max-w-xs truncate",title:e.note||"",children:e.note||"-"}),r.jsx(d.pj,{children:e.created_at?new Date(e.created_at).toLocaleString("vi-VN"):"-"})]},e.id))]})]})})]})}},4196:(e,t,a)=>{"use strict";a.d(t,{default:()=>l});var r=a(326),s=a(5047),n=a(7577),i=a(772);function l(){let[e,t]=(0,n.useState)(null),[a,l]=(0,n.useState)(!0),o=(0,s.useRouter)(),d=async()=>{try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"}),t(null),o.push("/login"),o.refresh()}catch(e){console.error("Logout failed:",e)}};return a?r.jsx("div",{className:"text-sm text-gray-600",children:"Đang tải..."}):e?(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("span",{className:"text-sm text-gray-600",children:["Xin ch\xe0o, ",e.name||e.email,e.role&&r.jsx("span",{className:"ml-1 px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded",children:e.role.name})]}),r.jsx(i.z,{variant:"secondary",size:"sm",onClick:d,children:"Đăng xuất"})]}):r.jsx(i.z,{variant:"secondary",size:"sm",onClick:()=>o.push("/login"),children:"Đăng nhập"})}},9082:(e,t,a)=>{"use strict";a.d(t,{default:()=>o});var r=a(326),s=a(6780),n=a(434),i=a(5047),l=a(7863);function o(){let{canManageAdmins:e,canManageSites:t,canManageContent:a,canViewAuditLogs:o,canManageUsers:d}=(0,s.T)(),c=(0,i.usePathname)();return r.jsx("nav",{className:"space-y-2 text-sm",children:[{href:"/sites",label:"Sites",show:t},{href:"/keywords",label:"Keywords",show:t},{href:"/content-queue",label:"Content Queue",show:a},{href:"/users",label:"Users",show:d},{href:"/admins",label:"Admins",show:e},{href:"/audit-logs",label:"Audit Logs",show:o}].map(e=>e.show?r.jsx(n.default,{href:e.href,className:(0,l.cn)("block rounded px-2 py-1 hover:bg-gray-100 transition-colors",c===e.href&&"bg-gray-100 font-medium"),children:e.label},e.href):null)})}},8143:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});var r=a(326),s=a(381);let n=function({children:e}){return(0,r.jsxs)(r.Fragment,{children:[e,r.jsx(s.x7,{position:"top-right"})]})}},567:(e,t,a)=>{"use strict";a.d(t,{C:()=>l});var r=a(326);a(7577);var s=a(9360),n=a(7863);let i=(0,s.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l({className:e,variant:t,...a}){return r.jsx("div",{className:(0,n.cn)(i({variant:t}),e),...a})}},772:(e,t,a)=>{"use strict";a.d(t,{z:()=>o});var r=a(326),s=a(8029),n=a.n(s);a(7577);let i={sm:"h-8 px-3 text-sm",md:"h-10 px-4 text-sm",lg:"h-12 px-6 text-base"},l={primary:"bg-blue-600 text-white hover:bg-blue-700 focus-visible:outline-blue-600",secondary:"bg-gray-100 text-gray-900 hover:bg-gray-200 focus-visible:outline-gray-400",ghost:"bg-transparent text-gray-900 hover:bg-gray-50 focus-visible:outline-gray-300",danger:"bg-red-600 text-white hover:bg-red-700 focus-visible:outline-red-600",outline:"border border-gray-300 bg-transparent text-gray-900 hover:bg-gray-50 focus-visible:outline-gray-300"};function o({className:e,variant:t="primary",size:a="md",disabled:s,...o}){return r.jsx("button",{className:n()("inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 disabled:opacity-50 disabled:pointer-events-none",i[a],l[t],e),disabled:s,...o})}},4432:(e,t,a)=>{"use strict";a.d(t,{I:()=>i});var r=a(326),s=a(7577),n=a(7863);let i=s.forwardRef(({className:e,type:t,...a},s)=>r.jsx("input",{type:t,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:s,...a}));i.displayName="Input"},5304:(e,t,a)=>{"use strict";a.d(t,{O:()=>n});var r=a(326),s=a(7863);function n({className:e,...t}){return r.jsx("div",{className:(0,s.cn)("animate-pulse rounded-md bg-muted",e),...t})}},5940:(e,t,a)=>{"use strict";a.d(t,{RM:()=>o,SC:()=>d,iA:()=>i,pj:()=>u,ss:()=>c,xD:()=>l});var r=a(326),s=a(7577),n=a(7863);let i=s.forwardRef(({className:e,...t},a)=>r.jsx("div",{className:"relative w-full overflow-auto",children:r.jsx("table",{ref:a,className:(0,n.cn)("w-full caption-bottom text-sm",e),...t})}));i.displayName="Table";let l=s.forwardRef(({className:e,...t},a)=>r.jsx("thead",{ref:a,className:(0,n.cn)("[&_tr]:border-b",e),...t}));l.displayName="TableHeader";let o=s.forwardRef(({className:e,...t},a)=>r.jsx("tbody",{ref:a,className:(0,n.cn)("[&_tr:last-child]:border-0",e),...t}));o.displayName="TableBody",s.forwardRef(({className:e,...t},a)=>r.jsx("tfoot",{ref:a,className:(0,n.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t})).displayName="TableFooter";let d=s.forwardRef(({className:e,...t},a)=>r.jsx("tr",{ref:a,className:(0,n.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t}));d.displayName="TableRow";let c=s.forwardRef(({className:e,...t},a)=>r.jsx("th",{ref:a,className:(0,n.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));c.displayName="TableHead";let u=s.forwardRef(({className:e,...t},a)=>r.jsx("td",{ref:a,className:(0,n.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));u.displayName="TableCell",s.forwardRef(({className:e,...t},a)=>r.jsx("caption",{ref:a,className:(0,n.cn)("mt-4 text-sm text-muted-foreground",e),...t})).displayName="TableCaption"},7863:(e,t,a)=>{"use strict";a.d(t,{cn:()=>n});var r=a(1135),s=a(1009);function n(...e){return(0,s.m6)((0,r.W)(e))}},6780:(e,t,a)=>{"use strict";a.d(t,{T:()=>n});var r=a(7577);let s=()=>{let[e,t]=(0,r.useState)(null),[a,s]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{(async function(){try{let e=await fetch("/api/auth/me",{credentials:"include"});if(e.ok){let a=await e.json();t(a)}else t(null)}catch(e){console.error("Auth check failed:",e),t(null)}finally{s(!1)}})()},[]),{user:e,isLoading:a}},n=()=>{let{user:e}=s();if(!e||!e.role)return{isAdmin:!1,isManager:!1,isViewer:!1,canManageAdmins:!1,canManageSites:!1,canManageContent:!1,canViewAuditLogs:!1,canManageUsers:!1,canViewDashboard:!1};let t=e.role.name;return{isAdmin:"admin"===t,isManager:"manager"===t,isViewer:"viewer"===t,canManageAdmins:"admin"===t,canManageUsers:"admin"===t,canManageSites:["admin","manager"].includes(t),canManageContent:["admin","manager"].includes(t),canViewAuditLogs:["admin","manager","viewer"].includes(t),canViewDashboard:["admin","manager","viewer"].includes(t)}}},9465:(e,t,a)=>{"use strict";a.r(t),a.d(t,{$$typeof:()=>i,__esModule:()=>n,default:()=>l});var r=a(8570);let s=(0,r.createProxy)(String.raw`D:\Workspace\beesmart\autoseo\dashboard\app\audit-logs\page.tsx`),{__esModule:n,$$typeof:i}=s;s.default;let l=(0,r.createProxy)(String.raw`D:\Workspace\beesmart\autoseo\dashboard\app\audit-logs\page.tsx#default`)},3119:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>f,metadata:()=>g});var r=a(9510);a(7272);var s=a(8570);let n=(0,s.createProxy)(String.raw`D:\Workspace\beesmart\autoseo\dashboard\app\partials\ClientAuthLinks.tsx`),{__esModule:i,$$typeof:l}=n;n.default;let o=(0,s.createProxy)(String.raw`D:\Workspace\beesmart\autoseo\dashboard\app\partials\ClientAuthLinks.tsx#default`),d=(0,s.createProxy)(String.raw`D:\Workspace\beesmart\autoseo\dashboard\app\partials\Navigation.tsx`),{__esModule:c,$$typeof:u}=d;d.default;let m=(0,s.createProxy)(String.raw`D:\Workspace\beesmart\autoseo\dashboard\app\partials\Navigation.tsx#default`),p=(0,s.createProxy)(String.raw`D:\Workspace\beesmart\autoseo\dashboard\app\providers.tsx`),{__esModule:h,$$typeof:x}=p;p.default,(0,s.createProxy)(String.raw`D:\Workspace\beesmart\autoseo\dashboard\app\providers.tsx#Providers`);let b=(0,s.createProxy)(String.raw`D:\Workspace\beesmart\autoseo\dashboard\app\providers.tsx#default`),g={title:"Autoseo Dashboard",description:"SEO Automation Dashboard"};function f({children:e}){return r.jsx("html",{lang:"en",children:r.jsx("body",{className:"min-h-screen bg-white text-black",children:r.jsx(b,{children:(0,r.jsxs)("div",{className:"flex min-h-screen",children:[(0,r.jsxs)("aside",{className:"hidden w-56 border-r p-4 md:block",children:[r.jsx("div",{className:"mb-6 font-semibold",children:"Autoseo"}),r.jsx(m,{})]}),(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("header",{className:"border-b",children:(0,r.jsxs)("div",{className:"container flex h-14 items-center justify-between",children:[r.jsx("div",{className:"font-semibold md:hidden",children:"Autoseo"}),r.jsx(o,{})]})}),r.jsx("main",{className:"container py-6",children:e})]})]})})})})}},7272:()=>{},9360:(e,t,a)=>{"use strict";a.d(t,{j:()=>i});var r=a(1135);let s=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,n=r.W,i=(e,t)=>a=>{var r;if((null==t?void 0:t.variants)==null)return n(e,null==a?void 0:a.class,null==a?void 0:a.className);let{variants:i,defaultVariants:l}=t,o=Object.keys(i).map(e=>{let t=null==a?void 0:a[e],r=null==l?void 0:l[e];if(null===t)return null;let n=s(t)||s(r);return i[e][n]}),d=a&&Object.entries(a).reduce((e,t)=>{let[a,r]=t;return void 0===r||(e[a]=r),e},{});return n(e,o,null==t?void 0:null===(r=t.compoundVariants)||void 0===r?void 0:r.reduce((e,t)=>{let{class:a,className:r,...s}=t;return Object.entries(s).every(e=>{let[t,a]=e;return Array.isArray(a)?a.includes({...l,...d}[t]):({...l,...d})[t]===a})?[...e,a,r]:e},[]),null==a?void 0:a.class,null==a?void 0:a.className)}}};var t=require("../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[948,246],()=>a(5575));module.exports=r})();